<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sigma Header Fragment Test</title>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
        }
        
        /* Simulate edit mode */
        body.has-edit-mode-menu .sigma-mega-dropzone {
            border-color: #3b82f6 !important;
            background-color: rgba(59, 130, 246, 0.05) !important;
        }
        
        .test-info {
            background: #1e40af;
            color: white;
            padding: 1rem;
            text-align: center;
            font-weight: 600;
        }
        
        .mega-dropzones-container {
            padding: 2rem;
            background: white;
            margin: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .mega-dropzones {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .sigma-mega-dropzone {
            background: #f8f9fa;
            border: 2px dashed #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            min-height: 120px;
        }
        
        .sigma-mega-dropzone-label {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin: 0 0 1rem 0;
            text-align: center;
        }
        
        .test-content {
            padding: 1rem;
            background: #f3f4f6;
            border-radius: 4px;
            text-align: center;
        }
        
        .console-output {
            background: #1f2937;
            color: #e5e7eb;
            padding: 1rem;
            border-radius: 4px;
            font-family: monospace;
            margin: 1rem 0;
            max-height: 300px;
            overflow-y: auto;
            font-size: 0.875rem;
            line-height: 1.4;
        }
        
        .status-indicator {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            margin: 1rem 0;
            font-weight: 600;
        }
        
        .status-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .status-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fbbf24;
        }
        
        .status-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
    </style>
</head>
<body class="has-edit-mode-menu">
    <div class="test-info">
        Sigma Header Fragment Test - Mega Menu Dropzone Functionality
    </div>
    
    <!-- Fragment Test Container -->
    <div class="sigma-header-fragment" id="test-fragment">
        <!-- Mega Menu Dropzones (Direct Approach) -->
        <div class="mega-dropzones-container">
            <h3>üéØ Direct Dropzones (Primary Approach)</h3>
            <p>These are direct dropzone elements that should be detected first.</p>
            
            <div class="mega-dropzones">
                <div>
                    <h4>Dropzone 1</h4>
                    <div id="dropzone-mega-menu-1">
                        <div class="test-content">
                            <strong>Dashboard Content</strong><br>
                            Quick dashboard overview and analytics
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4>Dropzone 2</h4>
                    <div id="dropzone-mega-menu-2">
                        <div class="test-content">
                            <strong>Catalogue Content</strong><br>
                            Browse our pharmaceutical product catalogue
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4>Dropzone 3</h4>
                    <div id="dropzone-mega-menu-3">
                        <div class="test-content">
                            <strong>Orders Management</strong><br>
                            Comprehensive order management tools<br>
                            <button style="margin-top: 0.5rem; padding: 0.25rem 0.5rem; background: #3b82f6; color: white; border: none; border-radius: 3px; cursor: pointer;">Manage Orders</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Wrapper Dropzones (Fallback Approach) -->
        <div class="mega-dropzones-container">
            <h3>üì¶ Wrapper Dropzones (Fallback Approach)</h3>
            <p>These are wrapper-style dropzones that should be used as fallback.</p>
            
            <div class="mega-dropzones">
                <div class="sigma-mega-dropzone">
                    <h4 class="sigma-mega-dropzone-label">Mega Menu Content 4</h4>
                    <div id="dropzone-mega-menu-4">
                        <div class="test-content">
                            <strong>Reports Content</strong><br>
                            Access comprehensive reports and analytics
                        </div>
                    </div>
                </div>
                
                <div class="sigma-mega-dropzone">
                    <h4 class="sigma-mega-dropzone-label">Mega Menu Content 5</h4>
                    <div id="dropzone-mega-menu-5">
                        <div class="test-content">
                            <strong>Settings Content</strong><br>
                            Account and system configuration
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Status and Console -->
        <div class="mega-dropzones-container">
            <h3>üìä Test Status</h3>
            <div id="status-container">
                <div class="status-indicator status-warning">
                    ‚è≥ Initializing fragment...
                </div>
            </div>
            
            <h3>üñ•Ô∏è Console Output</h3>
            <div class="console-output" id="console-output">
                üìù Console messages will appear here...<br>
                üîç Look for initialization logs and mapping information<br>
            </div>
        </div>
    </div>
    
    <script>
        console.log('üé≠ Test page initializing...');
        
        // Status tracking
        let initializationStarted = false;
        let fragmentLoaded = false;
        
        // Capture console logs for display
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        const consoleOutput = document.getElementById('console-output');
        const statusContainer = document.getElementById('status-container');
        
        function addLogEntry(level, args) {
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            const logEntry = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString();
            const levelIcon = level === 'error' ? '‚ùå' : level === 'warn' ? '‚ö†Ô∏è' : 'üìù';
            logEntry.innerHTML = `<span style="color: #9ca3af;">${timestamp}</span> ${levelIcon} ${message}`;
            logEntry.style.marginBottom = '0.25rem';
            
            if (level === 'error') logEntry.style.color = '#ef4444';
            if (level === 'warn') logEntry.style.color = '#f59e0b';
            
            consoleOutput.appendChild(logEntry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            
            // Update status based on log content
            if (message.includes('SIGMA HEADER SCRIPT LOADED')) {
                updateStatus('success', '‚úÖ Fragment script loaded successfully');
            } else if (message.includes('SIGMA HEADER FRAGMENT INITIALIZING')) {
                initializationStarted = true;
                updateStatus('success', 'üöÄ Fragment initialization started');
            } else if (message.includes('Using direct dropzone approach')) {
                updateStatus('success', 'üéØ Direct dropzone approach detected');
            } else if (message.includes('Using wrapper dropzone approach')) {
                updateStatus('warning', 'üì¶ Using wrapper dropzone fallback');
            } else if (message.includes('No dropzones found')) {
                updateStatus('error', '‚ùå No dropzones detected');
            }
        }
        
        function updateStatus(type, message) {
            statusContainer.innerHTML = `<div class="status-indicator status-${type}">${message}</div>`;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLogEntry('log', args);
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLogEntry('error', args);
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLogEntry('warn', args);
        };
        
        // Set up fragmentElement before loading the fragment script
        const fragmentElement = document.querySelector('.sigma-header-fragment');
        console.log('üîß Set fragmentElement:', fragmentElement ? 'Found' : 'Not Found');
        
        // Load the fragment CSS first
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = '/fragment-collection/sigma-pharmaceuticals-collection/sigma-header/index.css';
        link.onload = () => console.log('üìÑ Fragment CSS loaded');
        link.onerror = () => console.error('‚ùå Failed to load fragment CSS');
        document.head.appendChild(link);
        
        // Load the fragment JavaScript
        const script = document.createElement('script');
        script.src = '/fragment-collection/sigma-pharmaceuticals-collection/sigma-header/index.js';
        script.onload = function() {
            fragmentLoaded = true;
            console.log('‚úÖ Fragment JavaScript loaded successfully');
            
            // Wait a bit for initialization then check results
            setTimeout(() => {
                if (!initializationStarted) {
                    updateStatus('error', '‚ùå Fragment initialization did not start');
                }
            }, 2000);
        };
        script.onerror = function() {
            console.error('‚ùå Failed to load fragment JavaScript');
            updateStatus('error', '‚ùå Failed to load fragment script');
        };
        document.head.appendChild(script);
        
        console.log('üìú Loading fragment assets...');
    </script>
</body>
</html>