<style>
/* CRITICAL HEADER CSS: Inline for optimal LCP performance */
.jm-header-fragment {
  /* Essential CSS custom properties - scoped to fragment */
  --jm-primary: #0b5fff; /* Will be overridden by data attributes */
  --jm-text-color: #393a4a; /* Will be overridden by data attributes */
  --jm-white: #fff;
  --jm-gray-100: #f7f8f9;
  --jm-gray-200: #f1f2f5;
  --jm-gray-300: #e7e7ed;
  --jm-gray-400: #cdced9;
  --jm-gray-700: #495057;
  --jm-gray-800: #393a4a;
  
  /* Essential spacing */
  --jm-spacing-xs: 0.25rem;
  --jm-spacing-sm: 0.5rem;
  --jm-spacing-md: 1rem;
  --jm-spacing-lg: 1.5rem;
  --jm-spacing-xl: 2rem;
  
  /* Typography essentials */
  --jm-font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  --jm-font-size-base: 1rem;
  --jm-font-size-sm: 0.875rem;
  --jm-border-radius: 4px;
  --jm-transition: all 0.3s ease;
  
  /* Fragment isolation */
  font-family: var(--jm-font-family);
  color: var(--jm-text-color);
  contain: layout style;
}

/* CRITICAL: Header layout and styling scoped to fragment */
.jm-header-fragment .jm-header {
  background: var(--jm-white);
  border-bottom: 1px solid var(--jm-gray-300);
  position: relative;
  z-index: 100;
  width: 100%;
}

/* Configuration-driven header style variants */
[#if configuration.headerStyle == 'primary']
.jm-header-fragment .jm-header {
  background: var(--jm-primary) !important;
  color: var(--jm-white) !important;
  border-bottom: 1px solid var(--jm-primary) !important;
}
[/#if]

[#if configuration.headerStyle == 'light']
.jm-header-fragment .jm-header {
  background: var(--jm-gray-100) !important;
  border-bottom: 1px solid var(--jm-gray-400) !important;
}
[/#if]

.jm-header-fragment .jm-header-content {
  display: flex !important;
  align-items: center !important;
  justify-content: space-between !important;
  padding: var(--jm-spacing-md) 0 !important;
  min-height: 60px !important;
  max-width: 1200px !important;
  margin: 0 auto !important;
  width: 100% !important;
  box-sizing: border-box !important;
  padding-left: 1rem !important;
  padding-right: 1rem !important;
}

.jm-header-fragment .jm-header-logo {
  flex-shrink: 0 !important;
}

.jm-header-fragment .jm-logo-link {
  display: inline-block !important;
  text-decoration: none !important;
}

.jm-header-fragment .jm-logo {
  height: 40px !important;
  width: 180px !important;
  display: block !important;
}

.jm-header-fragment .jm-nav {
  flex: 1 !important;
  margin: 0 var(--jm-spacing-xl) !important;
}

.jm-header-fragment .jm-nav-list {
  display: flex !important;
  list-style: none !important;
  margin: 0 !important;
  padding: 0 !important;
  align-items: center !important;
  justify-content: center !important;
}

.jm-header-fragment .jm-nav-item {
  position: relative !important;
  margin: 0 var(--jm-spacing-sm) !important;
}

.jm-header-fragment .jm-nav-link {
  display: flex !important;
  align-items: center !important;
  padding: var(--jm-spacing-sm) var(--jm-spacing-md) !important;
  color: var(--jm-text-color) !important;
  text-decoration: none !important;
  font-weight: 500 !important;
  font-size: var(--jm-font-size-base) !important;
  border-radius: var(--jm-border-radius) !important;
  transition: var(--jm-transition) !important;
  white-space: nowrap !important;
}

/* Primary header style - white text on colored background */
[#if configuration.headerStyle == 'primary']
.jm-header-fragment .jm-nav-link {
  color: var(--jm-white) !important;
}
.jm-header-fragment .jm-nav-link:hover,
.jm-header-fragment .jm-nav-link:focus {
  color: var(--jm-white) !important;
  background-color: rgba(255, 255, 255, 0.1) !important;
}
[#else]
.jm-header-fragment .jm-nav-link:hover,
.jm-header-fragment .jm-nav-link:focus {
  color: var(--jm-primary) !important;
  background-color: var(--jm-gray-100) !important;
}
[/#if]

.jm-header-fragment .jm-header-actions {
  display: flex !important;
  align-items: center !important;
  gap: var(--jm-spacing-sm) !important;
  flex-shrink: 0 !important;
}

.jm-header-fragment .jm-header-action-btn {
  display: flex !important;
  align-items: center !important;
  gap: var(--jm-spacing-xs) !important;
  padding: var(--jm-spacing-sm) !important;
  background: none !important;
  border: 1px solid var(--jm-gray-300) !important;
  border-radius: var(--jm-border-radius) !important;
  color: var(--jm-text-color) !important;
  cursor: pointer !important;
  transition: var(--jm-transition) !important;
  font-size: var(--jm-font-size-sm) !important;
  font-weight: 500 !important;
}

[#if configuration.headerStyle == 'primary']
.jm-header-fragment .jm-header-action-btn {
  color: var(--jm-white) !important;
  border-color: rgba(255, 255, 255, 0.3) !important;
}
.jm-header-fragment .jm-header-action-btn:hover,
.jm-header-fragment .jm-header-action-btn:focus {
  background-color: rgba(255, 255, 255, 0.1) !important;
  border-color: rgba(255, 255, 255, 0.5) !important;
}
[#else]
.jm-header-fragment .jm-header-action-btn:hover,
.jm-header-fragment .jm-header-action-btn:focus {
  background-color: var(--jm-gray-100) !important;
  border-color: var(--jm-primary) !important;
  color: var(--jm-primary) !important;
}
[/#if]

/* Mobile menu toggle styling */
.jm-header-fragment .jm-mobile-menu-toggle {
  display: none !important;
  flex-direction: column !important;
  justify-content: space-around !important;
  width: 24px !important;
  height: 24px !important;
  background: none !important;
  border: none !important;
  cursor: pointer !important;
  padding: 0 !important;
  margin-right: var(--jm-spacing-sm) !important;
}

.jm-header-fragment .jm-hamburger span {
  display: block !important;
  height: 2px !important;
  width: 100% !important;
  background-color: var(--jm-text-color) !important;
  border-radius: 1px !important;
  transition: var(--jm-transition) !important;
}

[#if configuration.headerStyle == 'primary']
.jm-header-fragment .jm-hamburger span {
  background-color: var(--jm-white) !important;
}
[/#if]

/* CRITICAL: Mobile responsiveness */
@media (max-width: 768px) {
  .jm-header-fragment .jm-nav {
    display: none !important;
  }
  
  .jm-header-fragment .jm-mobile-menu-toggle {
    display: flex !important;
  }
  
  .jm-header-fragment .jm-header-content {
    padding-left: 1rem !important;
    padding-right: 1rem !important;
  }
}

/* Configuration visibility controls */
[#if !configuration.showSearch]
.jm-header-fragment .jm-search-btn {
  display: none !important;
}
[/#if]

[#if !configuration.showUserMenu]
.jm-header-fragment .jm-user-profile-widget,
.jm-header-fragment .jm-login-btn {
  display: none !important;
}
[/#if]
</style>

<div class="jm-header-fragment" 
     data-primary-color="[#if configuration.primaryColor??]${configuration.primaryColor}[#else]#0b5fff[/#if]"
     data-text-color="[#if configuration.textColor??]${configuration.textColor}[#else]#393a4a[/#if]"
     data-header-style="[#if configuration.headerStyle??]${configuration.headerStyle}[#else]white[/#if]">
  <header class="jm-header">
    <div class="jm-container">
      <div class="jm-header-content">
        <!-- Logo -->
        <div class="jm-header-logo">
          <a href="/" class="jm-logo-link">
            <img 
              src="[resources:johnson-matthey-logo.png]"
              alt="Johnson Matthey Logo"
              class="jm-logo"
              data-lfr-editable-id="logo"
              data-lfr-editable-type="image"
              width="180"
              height="40"
            />
          </a>
        </div>

        <!-- Main Navigation -->
        <nav class="jm-nav" role="navigation" aria-label="Main navigation">
          <ul class="jm-nav-list" id="jm-main-nav">
            <!-- Navigation will be populated by JavaScript -->
          </ul>
        </nav>

        <!-- Header Actions -->
        <div class="jm-header-actions">
          <!-- Mobile Menu Toggle -->
          <button class="jm-mobile-menu-toggle" aria-label="Toggle mobile menu" aria-expanded="false">
            <span class="jm-hamburger">
              <span></span>
              <span></span>
              <span></span>
            </span>
          </button>

          <!-- Search Button -->
          <button class="jm-header-action-btn jm-search-btn" aria-label="Open search">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
              <path d="m21 21-4.35-4.35" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>

          <!-- Login/User Button -->
          [#if themeDisplay.isSignedIn()]
            <div class="jm-user-profile-widget">
              [@liferay.user_personal_bar /]
            </div>
          [#else]
            <button class="jm-header-action-btn jm-login-btn" aria-label="Sign in">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" stroke="currentColor" stroke-width="2"/>
                <polyline points="10,17 15,12 10,7" stroke="currentColor" stroke-width="2"/>
                <line x1="15" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2"/>
              </svg>
              <span>Sign In</span>
            </button>
          [/#if]

          <!-- Language Selector Dropzone -->
          <div class="jm-language-selector-dropzone">
            <lfr-drop-zone data-lfr-drop-zone-id="language-selector">
            </lfr-drop-zone>
          </div>
        </div>
      </div>

      <!-- Mega Menu Dropzones (Edit Mode Only) -->
      <div class="jm-mega-menu-dropzones jm-edit-mode-only">
        <div class="jm-mega-dropzone">
          <h4 class="jm-mega-dropzone-label">Mega Menu Content 1</h4>
          <div id="dropzone-mega-menu-1">
            <lfr-drop-zone data-lfr-drop-zone-id="mega-menu-1">
            </lfr-drop-zone>
          </div>
        </div>
        <div class="jm-mega-dropzone">
          <h4 class="jm-mega-dropzone-label">Mega Menu Content 2</h4>
          <div id="dropzone-mega-menu-2">
            <lfr-drop-zone data-lfr-drop-zone-id="mega-menu-2">
            </lfr-drop-zone>
          </div>
        </div>
        <div class="jm-mega-dropzone">
          <h4 class="jm-mega-dropzone-label">Mega Menu Content 3</h4>
          <div id="dropzone-mega-menu-3">
            <lfr-drop-zone data-lfr-drop-zone-id="mega-menu-3">
            </lfr-drop-zone>
          </div>
        </div>
        <div class="jm-mega-dropzone">
          <h4 class="jm-mega-dropzone-label">Mega Menu Content 4</h4>
          <div id="dropzone-mega-menu-4">
            <lfr-drop-zone data-lfr-drop-zone-id="mega-menu-4">
            </lfr-drop-zone>
          </div>
        </div>
        <div class="jm-mega-dropzone">
          <h4 class="jm-mega-dropzone-label">Mega Menu Content 5</h4>
          <div id="dropzone-mega-menu-5">
            <lfr-drop-zone data-lfr-drop-zone-id="mega-menu-5">
            </lfr-drop-zone>
          </div>
        </div>
      </div>



      <!-- Mobile Navigation -->
      <div class="jm-mobile-nav" id="jm-mobile-nav">
        <ul class="jm-mobile-nav-list">
          <!-- Mobile navigation will be populated by JavaScript -->
        </ul>
        <div class="jm-mobile-nav-actions">
          [#if !themeDisplay.isSignedIn()]
            <button class="jm-btn jm-mobile-login-btn">Sign In</button>
          [#else]
            <a href="/c/portal/logout" class="jm-btn jm-btn-secondary">Sign Out</a>
          [/#if]
        </div>
      </div>

      <!-- Mobile Navigation -->
      <div class="jm-mobile-nav" id="jm-mobile-nav">
        <ul class="jm-mobile-nav-list">
          <!-- Mobile navigation will be populated by JavaScript -->
        </ul>
        <div class="jm-mobile-nav-actions">
          [#if !themeDisplay.isSignedIn()]
            <button class="jm-btn jm-mobile-login-btn">Sign In</button>
          [#else]
            <a href="/c/portal/logout" class="jm-btn jm-btn-secondary">Sign Out</a>
          [/#if]
        </div>
      </div>
    </div>
  </header>

  <!-- Search Modal -->
  <div id="jm-search-overlay" class="jm-search-overlay" style="display: none;">
    <div class="jm-search-modal">
      <div class="jm-modal-header">
        <h3 class="jm-modal-title" data-lfr-editable-id="search-title" data-lfr-editable-type="text">Search Johnson Matthey</h3>
        <button id="jm-close-search" class="jm-modal-close" aria-label="Close search">&times;</button>
      </div>
      <div class="jm-modal-body search-content">
        <lfr-drop-zone data-lfr-drop-zone-id="search">
        </lfr-drop-zone>
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  [#if !themeDisplay.isSignedIn()]
    <div id="jm-login-overlay" class="jm-login-overlay" style="display: none;">
      <div class="jm-login-modal">
        <div class="jm-modal-header">
          <h3 class="jm-modal-title" data-lfr-editable-id="login-title" data-lfr-editable-type="text">Sign In to Johnson Matthey</h3>
          <button id="jm-close-login" class="jm-modal-close" aria-label="Close login">&times;</button>
        </div>
        <div class="jm-modal-body login-content">
          [@liferay_portlet["runtime"] portletName="com_liferay_login_web_portlet_LoginPortlet" /]
        </div>
      </div>
    </div>
  [/#if]
</div>
